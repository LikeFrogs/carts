pico-8 cartridge // http://www.pico-8.com
version 27
__lua__

function _init()
	--initialize player
	player = {
		sprite = 1,
		x = 16,
		y = 48,
		w = 8,
		h = 8,

		dx = 0,
		dy = 0,

		flip = false,
		falling = false,
	}

	--control variables
	gravity = 0.3
	movementAcceleration = 0.5
	jumpAcceleration = 4
	maxHorizontalSpeed = 3
	maxFallSpeed = 5
	maxJumpSpeed = -4
end

function _update()
	--user input
	if btn(0) then 
		player.dx -= movementAcceleration
		player.flip = true
	end
	if btn(1) then 
		player.dx += movementAcceleration
		player.flip = false
	end
	if btn(2) and not player.falling then 
		player.dy -= jumpAcceleration
	end
	if btn(3) and player.falling then 
		player.dy += jumpAcceleration
	end

	--apply gravity
	player.dy += gravity;

	--apply max speeds
	if player.dx > maxHorizontalSpeed then
		player.dx = maxHorizontalSpeed
	end
	if player.dx < -maxHorizontalSpeed then
		player.dx = -maxHorizontalSpeed
	end
	player.dy = mid(maxJumpSpeed, player.dy, maxFallSpeed)

	--ground collision
	if collide_map(player, "down", 0) and player.falling then
		player.dy = 0
		player.falling = false
		player.y-=((player.y+player.h+1)%8)-1
	else
		player.falling = true
	end

	--apply accumulated acceleration
	player.x += player.dx
	player.y += player.dy --
end

function collide_map(obj, aim, flag)
	local x=obj.x  local y=obj.y
	local w=obj.w  local h=obj.h
   
	local x1=0	 local y1=0
	local x2=0  local y2=0
   
	if aim=="left" then
	  x1=x-1  y1=y
	  x2=x    y2=y+h-1   
	elseif aim=="right" then
	  x1=x+w-1    y1=y
	  x2=x+w  y2=y+h-1   
	elseif aim=="up" then
	  x1=x+2    y1=y-1
	  x2=x+w-3  y2=y   
	elseif aim=="down" then
	  x1=x+2      y1=y+h
	  x2=x+w-3    y2=y+h
	end
   
	--pixels to tiles
	x1/=8    y1/=8
	x2/=8    y2/=8
   
	if fget(mget(x1,y1), flag)
	or fget(mget(x1,y2), flag)
	or fget(mget(x2,y1), flag)
	or fget(mget(x2,y2), flag) then
	  return true
	else
	  return false
	end   
end

function _draw()
	cls()
	map(0,0)
	spr(player.sprite, player.x, player.y, 1, 1, player.flip)
end

__gfx__
00000000ccaccacc7777777788888888cccccccc00000000cccccccccccccccc0000000000000000000000000000000000000000000000000000000000000000
00000000ca99999ccccccccc99999999cccccccc00000000ccccc17ccccccccc0000000000000000000000000000000000000000000000000000000000000000
00700700ca97997ccccccc7caaaaaaaacccccccc00000000cccc1777cccccccc0000000000000000000000000000000000000000000000000000000000000000
00077000ca99999cccccc7ccbbbbbbbbcccccccc00000000ccccc17ccccccccc0000000000000000000000000000000000000000000000000000000000000000
00077000ccaaaacccccccccc11111111cccccccc00000000cccccccccccccccc0000000000000000000000000000000000000000000000000000000000000000
00700700ccaaaacccc00000022222222cccccccc00000000cccccccccccccccc0000000000000000000000000000000000000000000000000000000000000000
00000000ccaccacc00000000cccccccccccccccc0000000017cccccccccccccc0000000000000000000000000000000000000000000000000000000000000000
00000000ccaccacc00000000cccccccccccccccc00000000cccccccccccccccc0000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404060404040404040404040604040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040303030304040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040406040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404030303040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
